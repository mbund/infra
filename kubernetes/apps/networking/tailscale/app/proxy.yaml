apiVersion: v1
kind: Pod
metadata:
  name: nginx
  namespace: networking
spec:
  serviceAccountName: tailscale
  containers:
  - name: nginx
    image: nginx
    resources:
      limits:
        cpu: 500m
        memory: 500Mi
  - name: ts-sidecar
    imagePullPolicy: Always
    image: "ghcr.io/tailscale/tailscale:latest"
    env:
    - name: TS_KUBE_SECRET
      value: tailscale-auth
    - name: TS_USERSPACE
      value: "false"
    - name: TS_AUTH_KEY
      valueFrom:
        secretKeyRef:
          name: tailscale-secret
          key: auth-key
          optional: true
    securityContext:
      capabilities:
        add:
        - NET_ADMIN

    resources:
      limits:
        cpu: 500m
        memory: 500Mi
